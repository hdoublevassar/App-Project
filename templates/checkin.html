{% extends "base.html" %}

{% block title %}Mood Check-In - Sleep Tracker{% endblock %}

{% block content %}
<div class="form-page">
    <header class="page-header">
        <h1>Quick Check-In</h1>
        <p class="subtitle">Track your mood and energy throughout the day</p>
    </header>

    <form method="POST" class="checkin-form card">
        <input type="hidden" name="entry_date" value="{{ today }}">
        
        <!-- Time -->
        <div class="form-section">
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Check-in Time</label>
                    <input 
                        type="time" 
                        name="check_time" 
                        value="{{ current_time }}"
                        class="form-input time-picker"
                    >
                </div>
            </div>
        </div>

        <!-- Mood Level -->
        <div class="form-section">
            <h3 class="section-title">ðŸ˜Š Current Mood</h3>
            <div class="slider-container">
                <input 
                    type="range" 
                    name="mood_level" 
                    min="1" 
                    max="10" 
                    value="5"
                    class="mood-slider"
                    id="moodSlider"
                >
                <div class="slider-labels">
                    <span>1 - Very Low</span>
                    <span class="slider-value" id="moodValue">5</span>
                    <span>10 - Excellent</span>
                </div>
            </div>
        </div>

        <!-- Energy Level -->
        <div class="form-section">
            <h3 class="section-title">âš¡ Energy Level</h3>
            <div class="slider-container">
                <input 
                    type="range" 
                    name="energy_level" 
                    min="1" 
                    max="10" 
                    value="5"
                    class="mood-slider energy-slider"
                    id="energySlider"
                >
                <div class="slider-labels">
                    <span>1 - Drained</span>
                    <span class="slider-value" id="energyValue">5</span>
                    <span>10 - Energized</span>
                </div>
            </div>
        </div>

        <!-- Notes -->
        <div class="form-section">
            <label class="form-label">Quick Notes (optional)</label>
            <textarea 
                name="notes" 
                class="form-textarea"
                placeholder="What's going on right now? Just had coffee, after a meeting, feeling stressed..."
            ></textarea>
        </div>

        <!-- Submit -->
        <div class="form-actions">
            <a href="{{ url_for('home') }}" class="btn btn-outline">Cancel</a>
            <button type="submit" class="btn btn-primary">Save Check-In</button>
        </div>
    </form>

    <!-- Today's Check-ins -->
    {% if todays_checkins %}
    <section class="todays-checkins card">
        <h2>Today's Check-Ins</h2>
        <div class="checkins-timeline">
            {% for checkin in todays_checkins %}
            <div class="checkin-item">
                <span class="checkin-time">{{ checkin.check_time }}</span>
                <div class="checkin-levels">
                    <span class="mood-badge mood-{{ checkin.mood_level }}">
                        Mood: {{ checkin.mood_level }}
                    </span>
                    <span class="energy-badge energy-{{ checkin.energy_level }}">
                        Energy: {{ checkin.energy_level }}
                    </span>
                </div>
                {% if checkin.notes %}
                <p class="checkin-notes">{{ checkin.notes }}</p>
                {% endif %}
                <button 
                    class="delete-btn" 
                    onclick="deleteCheckin({{ checkin.id }})"
                    title="Delete this check-in"
                >Ã—</button>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Info card about tracking -->
    <section class="info-card card">
        <h3>ðŸ’¡ Why Track Throughout the Day?</h3>
        <p>
            Regular check-ins help identify patterns in your mood and energy levels. 
            Over time, this data can help predict your optimal sleep scheduleâ€”when 
            you should go to bed, how much sleep you need, and when you'll naturally 
            feel most energized.
        </p>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Update slider value displays
    function setupSlider(sliderId, valueId) {
        const slider = document.getElementById(sliderId);
        const valueDisplay = document.getElementById(valueId);
        
        if (slider && valueDisplay) {
            valueDisplay.textContent = slider.value;
            slider.addEventListener('input', () => {
                valueDisplay.textContent = slider.value;
            });
        }
    }
    
    setupSlider('moodSlider', 'moodValue');
    setupSlider('energySlider', 'energyValue');
    
    // Delete check-in
    async function deleteCheckin(id) {
        if (confirm('Delete this check-in?')) {
            await fetch(`/api/delete-checkin/${id}`, { method: 'POST' });
            window.location.reload();
        }
    }
</script>
{% endblock %}
